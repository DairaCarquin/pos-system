<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Listado de Sesiones de Caja</title>
</head>
<body>
<div layout:fragment="contenido">
    <h2 class="mb-4">Listado de Sesiones de Caja</h2>

    <!-- Barra de búsqueda -->
    <form th:action="@{/caja-sesion}" method="get" class="mb-3">
        <div class="d-flex">
            <input type="text" class="form-control form-control-sm me-2" style="max-width: 250px;" name="q"
                   placeholder="Buscar por caja, local, usuario, estado o fecha" th:value="${param.q}">
            <button type="submit" class="btn btn-primary btn-sm">
                <i class="bi bi-search"></i> Buscar
            </button>
        </div>
    </form>

    <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Sesiones de Caja</h5>
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>ID Sesión</th>
                    <th>Caja</th>
                    <th>Local</th>
                    <th>Usuario Apertura</th>
                    <th>Usuario Cierre</th>
                    <th>Fecha Apertura</th>
                    <th>Monto Inicial</th>
                    <th>Fecha Cierre</th>
                    <th>Monto Cierre</th>
                    <th>Estado</th>
                    <th>Transacciones</th> <!-- Columna agregada -->
                </tr>
                </thead>
                <tbody>
                <tr th:each="sesion : ${sesiones}">
                    <td th:text="${sesion.id}"></td>
                    <td th:text="${sesion.caja != null ? sesion.caja.nombre : ''}"></td>
                    <td th:text="${sesion.caja != null && sesion.caja.local != null ? sesion.caja.local.nombre : ''}"></td>
                    <td th:text="${sesion.usuarioApertura != null ? sesion.usuarioApertura.username : ''}"></td>
                    <td th:text="${sesion.usuarioCierre != null ? sesion.usuarioCierre.username : ''}"></td>
                    <td th:text="${sesion.fechaApertura != null ? #temporals.format(sesion.fechaApertura, 'yyyy-MM-dd HH:mm') : ''}"></td>
                    <td th:text="${sesion.montoInicial}"></td>
                    <td th:text="${sesion.fechaCierre != null ? #temporals.format(sesion.fechaCierre, 'yyyy-MM-dd HH:mm') : ''}"></td>
                    <td th:text="${sesion.montoCierre}"></td>
                    <td>
                        <span th:text="${sesion.estado}" th:classappend="${sesion.estado == 'ABIERTA'} ? 'badge bg-success' : 'badge bg-secondary'"></span>
                    </td>
                    <td>
    <a th:href="@{'/caja-sesion/reporte/' + ${sesion.id}}" target="_blank"
       class="btn btn-outline-primary btn-sm border-2" title="Ver transacciones" style="border-width:2px;">
        <i class="bi bi-eye" style="font-size:1.2rem; color:#0d6efd;"></i>
    </a>
</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Botón Volver debajo de la tabla -->
    <div class="mt-3">
        <a th:href="@{/caja}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Volver
        </a>
    </div>
</div>
</body>
</html>